services:
  wireguard_site:
    build:
      context: .
        # network: host
      args:
        # server | site | client
        BUILD_TARGET: server
        # changeme (used on client)
        WIREGUARD_SERVER_PUBLICIP: 0.0.0.0
        WIREGUARD_SERVER_LISTENING_PORT: 5060
        SITE_INET_CIDR: 192.168.1.0/24
    cap_add:
      - NET_ADMIN
      - NET_RAW
        #devices:
      #- "/dev/net/tun:/dev/net/tun"
    container_name: wireguard_site
    ports:
      - "5060:5060/udp"
    volumes:
      - ./mnt:/mnt
      - ./mnt:/etc/wireguard
    # debug
    tty: true
    stdin_open: true
    # environment:
    restart: on-failure
    command: ["/usr/local/bin/wireguard_start.sh"]
      # command: ["/bin/sh"]
